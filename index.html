<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO 8601 Date Converter</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .container-shadow {
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }
        /* Custom scrollbar for textareas */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

<div class="max-w-4xl mx-auto">
    <header class="text-center mb-10">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 tracking-tight mb-2">
            ISO 8601 Date Transformer
        </h1>
        <p class="text-lg text-gray-500">
            Convert date lists into the standard <code class="text-sm bg-gray-200 p-1 rounded">YYYY-MM-DDT00:00:00Z</code> format.
        </p>
    </header>

    <div class="bg-white p-6 rounded-xl container-shadow mb-8">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">1. Paste Your Dates</h2>
        <p class="text-sm text-gray-500 mb-3">
            Enter one date per line. Empty lines will be preserved in the output. Supported formats include: <code class="bg-indigo-100 px-1 rounded text-indigo-700">DD/MM/YY</code>, <code class="bg-indigo-100 px-1 rounded text-indigo-700">DD-MM-YYYY</code>, <code class="bg-indigo-100 px-1 rounded text-indigo-700">YYYY/MM/DD</code>, etc.
        </p>

        <textarea id="inputDates" rows="8"
            class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition duration-150 ease-in-out resize-none text-sm"
            placeholder="Example:\n30/09/12\n\n01-01-2024\n2023-05-10\n15/12/99"
        ></textarea>

        <div class="flex flex-col sm:flex-row justify-between items-center mt-4 space-y-3 sm:space-y-0">
            <button id="convertButton" onclick="convertDates()"
                class="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-medium text-lg rounded-lg hover:bg-indigo-700 transition duration-150 ease-in-out focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 active:bg-indigo-800 shadow-lg shadow-indigo-200/50"
            >
                Convert Dates
            </button>
            <div id="statusMessage" class="text-sm font-medium text-gray-600"></div>
        </div>
    </div>

    <!-- Output Section -->
    <div class="bg-white p-6 rounded-xl container-shadow">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-700">2. Reformatted Output</h2>
            <button id="copyButton" onclick="copyOutput()" disabled
                class="px-4 py-2 bg-green-500 text-white font-medium text-sm rounded-lg hover:bg-green-600 transition duration-150 ease-in-out focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 disabled:bg-green-300 shadow-md"
            >
                Copy All Reformatted Dates
            </button>
        </div>
        
        <div class="overflow-x-auto rounded-lg border border-gray-200">
            <table id="outputTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3">Original Input</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3">ISO 8601 Output</th>
                    </tr>
                </thead>
                <tbody id="outputTableBody" class="bg-white divide-y divide-gray-100">
                    <tr>
                        <td colspan="2" class="px-6 py-4 text-sm text-gray-400 text-center italic">
                            Results will appear here after conversion.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // --- Constants ---
    const FAILURE_MESSAGE = '--- PARSING FAILED ---';
    // Utility to pad single digits with a leading zero
    const pad = (num) => num < 10 ? '0' + num : num;

    // Global array to store the clean, copyable output for all lines
    let convertedResults = []; 

    // List of common formats to try parsing (in order of preference/commonality)
    const DATE_FORMATS = [
        // [Regex Pattern, Group 1: Day, Group 2: Month, Group 3: Year (2 or 4 digits)]
        { regex: /^(\d{1,2})[\/-](\d{1,2})[\/-](\d{2})$/, type: 'DMY_2' },   // DD/MM/YY or DD-MM-YY
        { regex: /^(\d{1,2})[\/-](\d{1,2})[\/-](\d{4})$/, type: 'DMY_4' },   // DD/MM/YYYY or DD-MM-YYYY
        { regex: /^(\d{4})[\/-](\d{1,2})[\/-](\d{1,2})$/, type: 'YMD' }      // YYYY/MM/DD or YYYY-MM-DD
    ];

    /**
     * Tries to parse a date string using known patterns and returns the Date object.
     * @param {string} dateString - The raw date string.
     * @returns {Date | null} The parsed Date object or null if parsing fails.
     */
    function parseFlexibleDate(dateString) {
        for (const fmt of DATE_FORMATS) {
            const match = dateString.match(fmt.regex);
            if (match) {
                const parts = match.slice(1).map(Number);
                let day, month, year;
                
                // Determine the order of parts based on the type
                if (fmt.type === 'YMD') {
                    [year, month, day] = parts;
                } else { // DMY_2 or DMY_4
                    [day, month, year] = parts;
                }
                
                // Handle 2-digit years (YY) - simple century rule
                if (fmt.type === 'DMY_2') {
                    // Simple rule: years > 50 are 19xx, years <= 50 are 20xx
                    year = (year > 50) ? 1900 + year : 2000 + year;
                }

                // Month is 0-indexed in Date constructor (Jan=0, Dec=11)
                const date = new Date(year, month - 1, day);

                // Basic validation: Check if the constructed date matches the input parts
                // (e.g., prevents dates like Feb 30th from being accepted)
                if (date.getFullYear() === year && date.getMonth() === (month - 1) && date.getDate() === day) {
                    return date;
                }
            }
        }
        return null;
    }

    /**
     * Copies all reformatted output from the stored array to the clipboard.
     */
    function copyOutput() {
        const statusElement = document.getElementById('statusMessage');
        const textToCopy = convertedResults.join('\n'); // Use the stored results directly
        
        if (textToCopy.length === 0 && convertedResults.length === 0) {
             const originalText = statusElement.innerHTML;
             statusElement.innerHTML = '<span class="text-red-600 font-bold">No output to copy.</span>';
             setTimeout(() => { statusElement.innerHTML = originalText; }, 2000);
             return;
        }

        // Use document.execCommand('copy') for better compatibility in iFrame environments
        try {
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = textToCopy;
            // Style it to be off-screen but still selectable
            tempTextarea.style.position = 'fixed'; 
            tempTextarea.style.top = '0';
            tempTextarea.style.left = '0';
            tempTextarea.style.opacity = '0';
            document.body.appendChild(tempTextarea);
            
            tempTextarea.select();
            
            let success = false;
            try {
                success = document.execCommand('copy');
            } catch (err) {
                console.error('Copy command failed:', err);
            }
            
            document.body.removeChild(tempTextarea);

            if (success) {
                const originalText = statusElement.innerHTML;
                statusElement.innerHTML = `<span class="text-green-600 font-bold">Copied ${convertedResults.length} lines (preserving all line breaks) to clipboard!</span>`;
                setTimeout(() => { statusElement.innerHTML = originalText; }, 2000);
            } else {
                console.error('Copy failed. Manual copy required.');
                const originalText = statusElement.innerHTML;
                statusElement.innerHTML = '<span class="text-red-600 font-bold">Copy failed! (Browser error)</span>';
                setTimeout(() => { statusElement.innerHTML = originalText; }, 2000);
            }
        } catch (err) {
            console.error('Error during copy operation:', err);
        }
    }

    /**
     * Main function to convert all dates from the textarea.
     */
    function convertDates() {
        const inputElement = document.getElementById('inputDates');
        const outputBody = document.getElementById('outputTableBody');
        const statusElement = document.getElementById('statusMessage');
        const copyButton = document.getElementById('copyButton');
        const rawInput = inputElement.value;
        
        // 1. Split the input by newlines. DO NOT filter out empty lines, preserving all line breaks.
        const rawLines = rawInput.split('\n');
        
        convertedResults = []; // Reset the global results array

        statusElement.textContent = `Processing ${rawLines.length} lines...`;
        outputBody.innerHTML = ''; 
        copyButton.disabled = true; 

        if (rawLines.length === 0 || rawLines.every(line => line.length === 0)) {
            // Handle completely empty input
            statusElement.textContent = 'No dates entered.';
            outputBody.innerHTML = `<tr><td colspan="2" class="px-6 py-4 text-sm text-gray-400 text-center italic">
                Please paste dates into the box above.
            </td></tr>`;
            return;
        }

        let successfulConversions = 0;
        let failedConversions = 0;
        let outputHTML = '';

        rawLines.forEach(rawLine => {
            const originalDate = rawLine.trim();
            let reformattedOutputText; // The clean text content for copying
            let reformattedOutputHTML; // The visually styled content for the table
            let rowClasses = 'whitespace-nowrap';

            if (originalDate.length === 0) {
                // Case 1: Empty or whitespace-only line
                reformattedOutputText = ''; // Output is an empty line
                reformattedOutputHTML = '<span class="text-gray-400 italic">Empty Line</span>'; // Visual placeholder for table cell
                rowClasses += ' bg-gray-50';
            } else {
                // Case 2: Non-empty line, attempt parsing
                const dt = parseFlexibleDate(originalDate);

                if (dt) {
                    // Success
                    reformattedOutputText = `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(dt.getDate())}T00:00:00Z`;
                    reformattedOutputHTML = reformattedOutputText;
                    rowClasses += ' text-gray-800';
                    successfulConversions++;
                } else {
                    // Failure
                    reformattedOutputText = FAILURE_MESSAGE;
                    reformattedOutputHTML = `<span class="text-red-500 font-semibold">${FAILURE_MESSAGE}</span>`;
                    rowClasses += ' bg-red-50 text-red-700';
                    failedConversions++;
                }
            }
            
            // Store the clean text for copying
            convertedResults.push(reformattedOutputText);

            outputHTML += `
                <tr class="${rowClasses} hover:bg-gray-100">
                    <td class="px-6 py-3 text-sm font-mono text-gray-600 w-1/3">${rawLine}</td>
                    <td class="px-6 py-3 text-sm font-mono w-2/3">${reformattedOutputHTML}</td>
                </tr>
            `;
        });

        outputBody.innerHTML = outputHTML;
        
        // Update status message and enable copy button
        const totalLines = rawLines.length;
        statusElement.innerHTML = `Processed ${totalLines} lines. <span class="text-green-600 font-bold">${successfulConversions} dates successful</span>, <span class="text-red-600 font-bold">${failedConversions} failed.</span>`;
        copyButton.disabled = false;
    }
    
    // Initial content population for quick testing
    window.onload = () => {
        const exampleDates = [
            "30/09/12",
            "", // Empty line preserved
            "01-01-2024",
            "2023-11-25",
            "15/12/99",
            "12/31/2025" // Expected to fail
        ];
        document.getElementById('inputDates').value = exampleDates.join('\n');
        convertDates();
    };

</script>

</body>
</html>
